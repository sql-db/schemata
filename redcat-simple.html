<html><head><title>Redcat Shoes</title>
    <style>
        area{cursor: pointer;}
        body {
           font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
           background-color: #FCF3CF;
        }
        </style>
</head><body>
<!-- use https://www.image-map.net/ to build image maps -->
<h2 style="clear: both; text-align: center; margin-top:2rem">
    <span style="color: #990000;">
    Database Schema for Redcat Shoes</span>
</h2>
<div style="width:100%;text-align:center;">
    <div style="display:inline-block;">
        <div style="display:inline-block;vertical-align:top; ">
            
            <img border="0" data-original-height="673" data-original-width="1177" src="https://1.bp.blogspot.com/-RokFn-GqSjs/XgphAD9SjkI/AAAAAAAAkLI/wbbAUxZ9bIoR6mrJphH5FezVtu_-iZQTACNcBGAsYHQ/s1600/redcat_transparent.png" usemap="#image-map"/>
            <map name="image-map">
                <area alt="customer" title="customer" coords="195,53,65,22" shape="rect">
                <area alt="customer.customerid" title="customer.customerid" coords="196,81,35,54" shape="rect">
                <area alt="customer.firstname" title="customer.firstname" coords="195,109,36,83" shape="rect">
                <area alt="customer.lastname" title="customer.lastname" coords="197,138,37,109" shape="rect">
                <area alt="customer.streetaddress" title="customer.streetaddress" coords="197,167,36,138" shape="rect">
                <area alt="customer.city" title="customer.city" coords="197,197,36,168" shape="rect">
                <area alt="customer.state" title="customer.state" coords="196,225,37,197" shape="rect">
                <area alt="customer.postalcode" title="customer.postalcode" coords="197,255,36,226" shape="rect">
                <area alt="customer.country" title="customer.country" coords="197,284,36,255" shape="rect">
                <area alt="customer.phone" title="customer.phone" coords="197,312,36,285" shape="rect">
                <area alt="manufacturer" title="manufacturer" coords="427,52,243,24" shape="rect">
                <area alt="manufacturer.manufacturerid" title="manufacturer.manufacturerid" coords="427,80,214,52" shape="rect">
                <area alt="manufacturer.manufacturername" title="manufacturer.manufacturername" coords="428,111,214,82" shape="rect">
                <area alt="manufacturer.address1" title="manufacturer.address1" coords="427,138,214,110" shape="rect">
                <area alt="manufacturer.address2" title="manufacturer.address2" coords="427,168,214,139" shape="rect">
                <area alt="manufacturer.city" title="manufacturer.city" coords="428,197,215,169" shape="rect">
                <area alt="manufacturer.state" title="manufacturer.state" coords="428,225,215,197" shape="rect">
                <area alt="manufacturer.postalcode" title="manufacturer.postalcode" coords="428,255,214,226" shape="rect">
                <area alt="manufacturer.phone" title="manufacturer.phone" coords="428,282,214,255" shape="rect">
                <area alt="manufacturer.fax" title="manufacturer.fax" coords="427,312,214,283" shape="rect">
                <area alt="manufacturer.contact" title="manufacturer.contact" coords="428,341,213,313" shape="rect">
                <area alt="manufacturer.url" title="manufacturer.url" coords="428,370,215,342" shape="rect">
                <area alt="product" title="product" coords="632,52,499,23" shape="rect">
                <area alt="product.productid" title="product.productid" coords="632,80,457,53" shape="rect">
                <area alt="product.productname" title="product.productname" coords="631,110,457,82" shape="rect">
                <area alt="product.manufacturerid" title="product.manufacturerid" coords="631,138,457,111" shape="rect">
                <area alt="product.composition" title="product.composition" coords="632,167,456,140" shape="rect">
                <area alt="product.listprice" title="product.listprice" coords="632,197,456,168" shape="rect">
                <area alt="product.gender" title="product.gender" coords="631,225,457,198" shape="rect">
                <area alt="product.category" title="product.category" coords="632,255,457,226" shape="rect">
                <area alt="product.color" title="product.color" coords="631,282,456,254" shape="rect">
                <area alt="product.description" title="product.description" coords="631,312,457,284" shape="rect">
                <area alt="sale.saleid" title="sale.saleid" coords="181,501,42,472" shape="rect">
                <area alt="sale.saledate" title="sale.saledate" coords="181,530,41,501" shape="rect">
                <area alt="sale.customerid" title="sale.customerid" coords="181,559,41,531" shape="rect">
                <area alt="sale.tax" title="sale.tax" coords="181,588,41,560" shape="rect">
                <area alt="sale.shipping" title="sale.shipping" coords="181,617,42,589" shape="rect">
                <area alt="saleItem" title="saleItem" coords="232,444,371,473" shape="rect">
                <area alt="saleItem.saleid" title="saleItem.saleid" coords="232,473,372,502" shape="rect">
                <area alt="saleItem.productid" title="saleItem.productid" coords="372,531,232,502" shape="rect">
                <area alt="saleItem.itemsize" title="saleItem.itemsize" coords="372,560,232,532" shape="rect">
                <area alt="saleItem.quantity" title="saleItem.quantity" coords="372,589,233,561" shape="rect">
                <area alt="saleItem.saleprice" title="saleItem.saleprice" coords="373,619,233,589" shape="rect">
                <area alt="inventoryItem" title="inventoryItem" coords="422,443,610,473" shape="rect">
                <area alt="inventoryItem.productid" title="inventoryItem.productid" coords="610,502,422,474" shape="rect">
                <area alt="inventoryItem.itemsize" title="inventoryItem.itemsize" coords="610,531,422,503" shape="rect">
                <area alt="inventoryItem.qtyonhand" title="inventoryItem.qtyonhand" coords="609,560,423,532" shape="rect">
                <area alt="itemSize" title="itemSize" coords="463,571,587,599" shape="rect">
                <area alt="itemSize.itemsize" title="itemSize.itemsize" coords="588,629,464,599" shape="rect">
                <area alt="purchaseItem" title="purchaseItem" coords="840,472,664,443" shape="rect">
                <area alt="purchaseItem.productid" title="purchaseItem.productid" coords="840,501,664,472" shape="rect">
                <area alt="purchaseItem.itemsize" title="purchaseItem.itemsize" coords="841,530,664,502" shape="rect">
                <area alt="purchaseItem.purchaseid" title="purchaseItem.purchaseid" coords="840,560,664,530" shape="rect">
                <area alt="purchaseItem.quantity" title="purchaseItem.quantity" coords="840,588,664,560" shape="rect">
                <area alt="purchaseItem.purchasePrice" title="purchaseItem.purchasePrice" coords="840,617,664,588" shape="rect">
                <area alt="purchase" title="purchase" coords="1121,471,882,442" shape="rect">
                <area alt="purchase.purchaseid" title="purchase.purchaseid" coords="1122,500,882,470" shape="rect">
                <area alt="purchase.purchasedate" title="purchase.purchasedate" coords="1121,528,882,501" shape="rect">
                <area alt="purchase.employeeid" title="purchase.employeeid" coords="1121,559,882,530" shape="rect">
                <area alt="purchase.expecteddeliverydate" title="purchase.expecteddeliverydate" coords="1121,588,882,559" shape="rect">
                <area alt="purchase.manufacturerid" title="purchase.manufacturerid" coords="1122,616,882,589" shape="rect">
                <area alt="purchase.shipping" title="purchase.shipping" coords="1122,645,882,617" shape="rect">
                <area alt="employee" title="employee" coords="1123,49,968,21" shape="rect">
                <area alt="employee.employeeid" title="employee.employeeid" coords="1124,80,967,50" shape="0">
                <area alt="employee.firstname" title="employee.firstname" coords="1122,107,967,80" shape="0">
                <area alt="employee.lastname" title="employee.lastname" coords="1122,137,967,108" shape="0">
                <area alt="employee.address" title="employee.address" coords="1122,167,968,137" shape="0">
                <area alt="employee.city" title="employee.city" coords="1122,195,967,166" shape="0">
                <area alt="employee.state" title="employee.state" coords="1124,223,967,196" shape="0">
                <area alt="employee.zip" title="employee.zip" coords="1124,254,968,224" shape="0">
                <area alt="employee.phone" title="employee.phone" coords="1124,281,967,255" shape="0">
                <area alt="employee.managerid" title="employee.managerid" coords="1124,311,967,282" shape="0">
                <area alt="employee.ssn" title="employee.ssn" coords="1122,340,967,311" shape="0">
                <area alt="employee.emailaddress" title="employee.emailaddress" coords="1124,368,967,340" shape="0">
                <area alt="employee.hiredate" title="employee.hiredate" coords="1122,398,967,368" shape="0">
                <area alt="wageEmployee" title="wageEmployee" coords="894,51,702,24" shape="rect">
                <area alt="wageEmployee.employeeid" title="wageEmployee.employeeid" coords="894,82,702,52" shape="rect">
                <area alt="wageEmployee.wage" title="wageEmployee.wage" coords="892,109,702,81" shape="rect">
                <area alt="wageEmployee.maxhours" title="wageEmployee.maxhours" coords="892,139,702,111" shape="rect">
                <area alt="salaryEmployee" title="salaryEmployee" coords="902,193,702,165" shape="rect">
                <area alt="salaryEmployee.employeeid" title="salaryEmployee.employeeid" coords="902,222,702,193" shape="rect">
                <area alt="salaryEmployee.salary" title="salaryEmployee.salary" coords="902,252,702,222" shape="rect">
            
            

            
                <area alt="customer JOIN sale ON customer.customerid = sale.customerid" title="customer JOIN sale ON customer.customerid = sale.customerid" coords="34,546,14,60" shape="rect">
                <area alt="sale JOIN saleItem ON sale.saleid = saleItem.saleid" title="sale JOIN saleItem ON sale.saleid = saleItem.saleid" coords="180,473,232,501" shape="rect">
                <area alt="saleItem JOIN inventoryItem ON saleItem.productid = inventoryItem.productid AND saleItem.itemsize = inventoryItem.itemsize" title="saleItem JOIN inventoryItem ON saleItem.productid = inventoryItem.productid AND saleItem.itemsize = inventoryItem.itemsize" coords="408,521,423,521,422,482,372,508,372,552" shape="poly">
                <area alt="purchaseItem JOIN inventoryItem ON purchaseItem.productid = inventoryItem.productid AND purchaseItem.itemsize = inventoryItem.itemsize" title="purchaseItem JOIN inventoryItem ON purchaseItem.productid = inventoryItem.productid AND purchaseItem.itemsize = inventoryItem.itemsize" coords="610,485,664,524" shape="rect">
                <area alt="inventoryItem JOIN itemSize ON inventoryItem.itemsize =itemSize .itemsize " title="inventoryItem JOIN itemSize ON inventoryItem.itemsize =itemSize .itemsize " coords="422,519,410,519,409,620,464,621,463,608,422,607" shape="poly">
                <area alt="purchaseItem JOIN purchase ON purchaseItem.purchaseid = purchase.purchaseid" title="purchaseItem JOIN purchase ON purchaseItem.purchaseid = purchase.purchaseid" coords="882,479,841,551" shape="0">
                <area alt="employee JOIN purchase ON employee.employeeid = purchase.employeeid" title="employee JOIN purchase ON employee.employeeid = purchase.employeeid" coords="1124,59,1149,547" shape="rect">
                <area alt="employee JOIN wageEmployee ON employee.employeeid = wageEmployee.employeeid" title="employee JOIN wageEmployee ON employee.employeeid = wageEmployee.employeeid" coords="966,67,894,55" shape="rect">
                <area alt="employee JOIN salaryEmployee ON employee.employeeid = salaryEmployee.employeeid" title="employee JOIN salaryEmployee ON employee.employeeid = salaryEmployee.employeeid" coords="967,66,903,214" shape="rect">
                <area alt="product JOIN manufacturer ON product.manufacturerid = manufacturer.manufacturerid" title="product JOIN manufacturer ON product.manufacturerid = manufacturer.manufacturerid" coords="427,64,455,129" shape="rect">
                <area alt="inventoryItem JOIN product ON inventoryItem.productid = product.productid" title="inventoryItem JOIN product ON inventoryItem.productid = product.productid" coords="632,62,647,62,646,484,610,484,608,470,633,470" shape="poly">
                <area alt="manufacturer JOIN purchase ON manufacturer.manufacturerid = purchase.manufacturerid" title="manufacturer JOIN purchase ON manufacturer.manufacturerid = purchnase.manufacturerid" coords="428,8,1164,9,1165,607,1123,609,1122,591,1155,591,1154,21,443,22,443,63,427,63" shape="poly">


            </map>
            <div id="msg"></div>
        </div>

        <div style="display:inline-block;">
            <textarea disabled id="sql" style="height:200px;width:600px" placeholder="Click the diagram to build SQL SELECT and FROM clauses."></textarea><br /><button id="copy" onclick="copyMe('sql')">Copy</button>&nbsp;<button id="clear" onclick="clear_sql()">Clear</button>
        </div>    
    </div>
</div>
<br />
<script type="text/javascript">
    const query={select:[],from:[], tables:[]}
    const sql=document.getElementById("sql")
    for(let link of document.getElementsByTagName("area")){
        link.onclick = function(){amend_sql(this.title)}
    }
    function clear_sql(){
        sql.value = ""
        query.select = []
        query.from = []
        query.tables = []
    }

    function add_field(table,field){
        console.log("table",table)
        console.log("field",field)
        if(query.select.indexOf(table + "." + field)>-1){return}
        if(query.tables.length===0){
            //query is empty, just build the query
            query.select.push(table + "." + field)        
            query.tables.push(table) 
            query.from.push(table)  
            return
        }else if(query.tables.indexOf(table)===-1){
            // query already has some data and the table specified is nit in the list of tables, can't add field
            return "Cannot add table to query.  Try clicking ON a link instead."
        }else if(field==="*"){
            // we already have 
            return "Cannot add table to query.  Try clicking ON a field instead."
        }else if(query.select.length===1 && query.select[0]==="*"){
            // there is currently only one field, and it is start.  neex to replace
            query.select[0]=table + "." + field
        }else{ 
            // must have been a field in one of the tables in the query
            query.select.push(table + "." + field)        
        }
    }

    function amend_sql(fragment) {
        console.log("sql", sql.value)
        console.log("fragment", fragment)
        let local_sql="SELECT  "
        let message=""
//        let fieldname = fragment
//        let tablename = fragment
        if(fragment.indexOf(".")===-1){
            // we have a table only
            message = add_field(fragment,"*")
            if(message){
                alert(message)
                return
            }
        }else if(fragment.indexOf(" JOIN ")===-1){ 
            // we have a dot in in the title and no join, it must be a field
            console.log("trying to add a field")
            message = add_field(fragment.split(".")[0],fragment.split(".")[1])
            if(message){
                alert(message)
                return
            }

        }else{ 
            // atom is a link
            // find the talbes in the link
            let temp=fragment.replace(" JOIN "," ").split(" ")
            let match_count=0
            let table_to_add
            const table1=temp[0]
            const table2=temp[1]

            if(query.tables.length===0){
                // query is empty, configure from scratch
                message = add_field(table1,"*")
                if(message){
                    alert(message)
                    return
                }
                // now get ready to add the join clause
                let frag=fragment.split(" ON ")[1]
                console.log("frag",frag)
                // push the rest into the next entry
                query.from.push("  JOIN  " + table2+  "\n    ON  " + frag)
                query.tables.push(table2)        

            }else{
                //there is already a table in the query.  need to check to see if atom join makes sense
                console.log("fragment----->",fragment)
                for(const tname of query.tables){
                    console.log("tname",tname)
                    console.log("table1",table1)
                    console.log("table2",table2)
                    if(tname===table1){
                        match_count++
                        console.log(tname, "is already in the query")
                        table_to_add=table2
                    }
                    if(tname===table2){
                        match_count++
                        console.log(tname, "is already in the query")
                        table_to_add=table1
                    }
                }
                console.log("table_to_add",table_to_add)
                if(match_count===0){
                    alert('Neither "' + table1 + '" nor "' + table2 + '" is already in the query, so we cannot add the selected join.')
                }else if(match_count===1){
                    console.log("ready to add", fragment)
                    query.from.push("  JOIN  " + table_to_add + "\n    ON  " + fragment.split(" ON ")[1].replace(/ AND /g, '\n    AND '))
                    query.tables.push(table_to_add)
                }else{
                    alert('Both "' + table1 + '" and "' + table2 + '" are already in the query, so we cannot add the selected join.')

                }
            }
        }

        
        console.log("query",query)
        // write out the query
        for(let x=0;x<query.select.length;x++){
            if(x>0){local_sql += "\n        ,"}
            if(query.select[x].indexOf(".")===-1){
                local_sql +=  query.select[x]  // there is no prefix, show the whole thing.   should only happen when value is "*"
            }else if(query.tables.length===1){
                local_sql += query.select[x].split(".")[1]// there is only one table, no need to prefix
            }else{
                local_sql += query.select[x]// multiple tables, let's add prefixes
            }
        }
        for(let x=0;x<query.from.length;x++){
            local_sql += "\n"
            if(x===0){local_sql +="FROM    "}
            local_sql += query.from[x] 
        }
        sql.value=local_sql
        return false;

    }
    function copyMe(element){
        let copier = document.getElementById(element)
        copier.disabled=false
        copier.select()
        document.execCommand('copy')
        copier.disabled=true
        //document.getElementById("msg").innerHTML="Copied to the clipboard: " + fragment
    }

</script>
</body>    
</html>